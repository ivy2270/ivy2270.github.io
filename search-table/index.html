<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>桌次查詢</title>
	<link rel="icon" type="image/svg+xml" href="wine-glass-svgrepo-com.svg">
    <style>
        /* 採用系統預設字體，省去下載時間 */
        :root { --p: #1a237e; --bg: #f0f2f5; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 500px; }
		h1 { color: var(--p); text-align: center; font-size: 22px; margin: 10px 0; }
        
        /* 預留高度防止跳動 */
        .search-container { position: sticky; top: 0; display: flex; gap: 8px; background: var(--bg); padding: 10px 0; width: 100%; }
        .search-box { flex: 1; min-width: 0; padding: 14px; font-size: 18px; border: 2px solid var(--p); border-radius: 10px; outline: none; }
        .clear-btn { padding: 0 15px; background: #90a4ae; color: #fff; border: none; border-radius: 10px; font-weight: bold; white-space: nowrap; }

        .guest-card { background: #fff; border-radius: 12px; padding: 16px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 6px solid var(--p); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .guest-name { font-size: 22px; font-weight: bold; margin-bottom: 2px; }
        .guest-org { font-size: 14px; color: #666; }
        .table-badge { background: var(--p); color: #fff; padding: 8px; border-radius: 8px; text-align: center; min-width: 60px; }
        .table-num { font-size: 24px; font-weight: bold; display: block; }
        
        #status { text-align: center; color: #999; font-size: 14px; margin-top: 15px; }
        /* 隱藏未搜尋時的卡片 */
        #resultsList { width: 100%; }
    </style>
</head>
<body>

<div class="container">
<h1>賓客歡迎查詢系統</h1>
    <div class="search-container">
        <input type="text" id="searchInput" class="search-box" placeholder="點擊此處輸入姓名..." autocomplete="off">
        <button id="clearBtn" class="clear-btn">清空</button>
    </div>
    <div id="status">準備中...</div>
    <div id="resultsList"></div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxmcFoTi_durh7ZGKyQ7d7wmuHPyth47MB0oypGxfBcGF_WIEZ9qhqVj-bscudAl_M/exec';
    let guestData = [];

    // 異步平行處理：不阻塞頁面渲染
    (async function init() {
        const status = document.getElementById('status');
        try {
            // 使用更輕量的 fetch 配置
            const res = await fetch(scriptURL, { method: 'GET', mode: 'cors' });
            guestData = await res.json();
            status.innerText = "請輸入姓名查詢桌次";
        } catch (e) {
            status.innerText = "網路不穩，請重新掃描";
        }
    })();

    const input = document.getElementById('searchInput');
    const list = document.getElementById('resultsList');
    const status = document.getElementById('status');

    document.getElementById('clearBtn').onclick = () => {
        input.value = '';
        list.innerHTML = '';
        status.style.display = 'block';
        input.focus();
    };

    input.oninput = () => {
        const key = input.value.trim().toLowerCase();
        if (!key) { list.innerHTML = ''; status.style.display = 'block'; return; }
        
        // 極速過濾邏輯
        const matched = guestData.filter(g => 
            (g['姓名'] && g['姓名'].includes(key)) || 
            (g['單位'] && g['單位'].includes(key))
        ).sort((a,b) => {
            if (a['姓名'] === key) return -1;
            return a['姓名'].startsWith(key) ? -1 : 1;
        });

        status.style.display = matched.length ? 'none' : 'block';
        if (!matched.length) status.innerText = "查無資料";

        // 使用 DocumentFragment 一次性渲染，減少 DOM 操作
        const frag = document.createDocumentFragment();
        matched.slice(0, 10).forEach(g => { // 限制顯示前10筆，加快渲染
            const div = document.createElement('div');
            div.className = 'guest-card';
            div.innerHTML = `<div><div class="guest-name">${g['姓名']}</div><div class="guest-org">${g['單位']||''}</div></div>
                             <div class="table-badge"><span style="font-size:10px">桌次</span><span class="table-num">${g['桌次']}</span></div>`;
            frag.appendChild(div);
        });
        list.innerHTML = '';
        list.appendChild(frag);
    };
</script>
</body>
</html>
